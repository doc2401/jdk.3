<HTML>
<HEAD>
   <TITLE>Getting Started with Java IDL: Developing the Hello World Server</TITLE>
<!-- Changed by: vlc, 7/22/97 -->
   <X-SAS-WINDOW TOP=42 BOTTOM=477 LEFT=4 RIGHT=534>
</HEAD>
<BODY BGCOLOR="#FFFFFF">


<H1 ALIGN=CENTER>Getting Started with Java IDL: Developing the Hello World Server</H1>
<HR>

<P>The example server consists of two classes, the servant and the

server. The servant, <TT>HelloServant</TT>, is the implementation of

the <TT>Hello</TT> IDL interface; each <TT>Hello</TT> instance is implemented

by a <TT>HelloServant</TT> instance. The servant is a subclass of

<TT>_HelloImplBase</TT>, which 

is generated by the <TT>idlj</TT> compiler from the example IDL.

The servant contains one method for each IDL operation, in this

example, just the <TT>sayHello()</TT> method. Servant methods are

just like ordinary Java methods; the extra code to deal with the ORB,

with marshaling arguments and results, and so on, is provided by the

server and the stubs.</P>

<P>The server class has the server's <TT>main()</TT> method, which:

</P>
<UL>

   <LI>Creates an ORB instance

   <LI>Creates a servant instance (the implementation of one CORBA

   <TT>Hello</TT> object) and tells the ORB about it


   <LI>Gets a CORBA object reference for a naming context in which to

   register the new CORBA object


   <LI>Registers the new object in the naming context under the name "Hello"


   <LI>Waits for invocations of the new object
</UL>



<P>This lesson introduces the basics of writing a CORBA transient server.
The steps in this topic cover:

<OL>
<LI><A href="#create">Creating HelloServer.java</A>
<LI><A href="#understand">Understanding HelloServer.java</A>
<LI><A href="#compile">Compiling the Hello World Server</A>
</OL>

<P>

<P>To see the complete version of 
<A href="server/HelloServer.java">HelloServer.java</A>, 
follow the link.

<A NAME="create">
<H2>Creating HelloServer.java</H2></A>
<P>To create <TT>HelloServer.java</TT>,
<P>
<OL>
<LI>Start your text editor and create a file named <TT>HelloServer.java</TT> in your main project directory, <TT>Hello</TT>.
<P>
<LI>Enter the following code for <TT>HelloServer.java</TT> in the text file.  The following section, <A HREF="#understand">Understanding HelloServer.java</A>, explains each line of code in some detail.
<P>
<PRE>
// The package containing our stubs.
import HelloApp.*;

// HelloServer will use the naming service.
import org.omg.CosNaming.*;

// The package containing special exceptions thrown by the name service.
import org.omg.CosNaming.NamingContextPackage.*;

// All CORBA applications need these classes.
import org.omg.CORBA.*;



public class HelloServer 
{
  public static void main(String args[])
  {
    try{
    
      // Create and initialize the ORB
      ORB orb = ORB.init(args, null);
      
      // Create the servant and register it with the ORB
      HelloServant helloRef = new HelloServant();
      orb.connect(helloRef);
      
      // Get the root naming context
      org.omg.CORBA.Object objRef = orb.resolve_initial_references("NameService");
      NamingContext ncRef = NamingContextHelper.narrow(objRef);
      
      // Bind the object reference in naming
      // Make sure there are no spaces between ""
      NameComponent nc = new NameComponent("Hello", "");
      NameComponent path[] = {nc};
      ncRef.rebind(path, helloRef);
      
      // Wait for invocations from clients
      java.lang.Object sync = new java.lang.Object();
      synchronized(sync){
        sync.wait();
      }
      
    } catch(Exception e) {
        System.err.println("ERROR: " + e);
        e.printStackTrace(System.out);
      }  
  }
}



class HelloServant extends _HelloImplBase
{
  public String sayHello()
  {
    return "\nHello world!!\n";
  
  }
}
</PRE>
<P>
<LI>Save and close <TT>HelloServer.java</TT>.
</OL>

<!--**********************************-->

<A NAME="understand">
<H2>Understanding HelloServer.java</H2></A>
<P>This section explains each line of <TT>HelloServer.java</TT>, describing what 
the code does, as well as why it is needed for this application.


<A name="setup">
<H3>Performing Basic Setup</H3></A>

<P>The structure of a CORBA server program is the same as most 
Java applications:&nbsp;You import
required library packages, declare the server class, define a <TT>main()</TT>
method, and handle exceptions.

<A name="import">
<H4>Importing Required Packages</H4></A>

<P>First, we import the packages required for the server class:
<PRE>
// The package containing our stubs.
import HelloApp.*;

// HelloServer will use the naming service.
import org.omg.CosNaming.*;

// The package containing special exceptions thrown by the name service.
import org.omg.CosNaming.NamingContextPackage.*;

// All CORBA applications need these classes.
import org.omg.CORBA.*;

</PRE>

<A name="class">
<H4>Declaring the Server Class</H4></A>

<P>The next step is to declare the server class:
<PRE>
public class HelloServer 
{
  // The main() method goes here.
}
</PRE>


<A name="main">
<H4>Defining the main() Method</H4></A>

<P>Every Java application needs a <TT>main</TT> method.  It is declared within the scope of the <TT>HelloServer</TT> class:
<PRE>
  public static void main(String args[])
  {
    // The try-catch block goes here.
  }
</PRE>

<A name="except">
<H4>Handling CORBA System Exceptions</H4></A>

<P>Because all CORBA programs can throw CORBA system exceptions at
runtime, all of the <TT>main()</TT> functionality is placed within a 
try-catch block. CORBA programs throw runtime exceptions whenever trouble
occurs during any of the processes (marshaling, unmarshaling, upcall) 
involved in invocation. The exception handler
simply prints the exception and its stack trace to standard output so you can
see what kind of thing has gone wrong. 

<P>The try-catch block is set up inside <TT>main()</TT>, as shown:
<PRE>
    try{
    
      // The rest of the HelloServer code goes here.
    
    } catch(Exception e) {
        System.err.println("ERROR: " + e);
        e.printStackTrace(System.out);
      }
</PRE>



<!--************************************************-->
<A name="orb">
<H3>Creating an ORB Object</H3></A>

<P>Just like in the client application, a CORBA server also needs a local ORB object. Every
server instantiates an ORB and registers its
<A href="../jidlGlossary.html#servant object">servant objects</A> so that 
the ORB can find the
server when it receives an invocation for it.


<P>The ORB variable is declared and initialized inside the try-catch block.
<PRE>
      ORB orb = ORB.init(args, null);
</PRE>

<P>The call to the ORB's <TT>init()</TT> method passes
in the server's command line arguments, allowing you to set certain 
<A href="../jidlInitialization.html#systempropertiesobject">properties</A> 
at runtime. 



<!--**********************************-->
<A name="servantobject">
<H3>Managing the Servant Object</H3></A>

A <A href="../jidlGlossary.html#server">server</A> is a process 
that instantiates one or more servant objects. The 
<A href="../jidlGlossary.html#servant object">servant</A>
implements the interface generated by <TT>idlj</TT> and actually performs the 
work of the operations on that interface. Our 
<TT>HelloServer</TT> needs a <TT>HelloServant</TT>.

<A name="servant">
<H4>Instantiating the Servant Object</H4></A>


<P>We instantiate the servant object inside the try-catch block, just below the call to <TT>init()</TT>, as shown:
<PRE>
      HelloServant helloRef = new HelloServant();
</PRE>
<P>The section of code describing the servant class will be explained in a later step.

<P>The next step is to connect the servant to the ORB, so that the ORB can 
recognize invocations on it and pass them along to the correct servant:
<PRE>
      orb.connect(helloRef);
</PRE>

<A name="helloservant">
<H4>Defining the Servant Class</H4></A>

<P>At the end of <TT>HelloServer.java</TT>, outside the <TT>HelloServer</TT> class,
we define the class for the servant object.

<P>
<PRE>
class HelloServant extends _HelloImplBase
{
  // The sayHello() method goes here.
}
</PRE>
<P>The servant is a subclass of <TT>_HelloImplBase</TT> so that it inherits 
the general
CORBA functionality generated for it by the compiler.<P>

Next, we declare the required <TT>sayHello()</TT> method:<P>
<PRE>
  public String sayHello()
  {
    // The method implementation goes here.
  }
</PRE>

<p>The <TT>sayHello()</TT> implementation looks like this:
<PRE>
    return "\nHello world!!\n";
</PRE>



<!--*********************************************-->

<A name="namingservice">
<H3>Working with COS Naming</H3></A>

<P>The <TT>HelloServer</TT> works with the naming service to make the servant
object's operations available
to clients.  The server needs an object reference to the name service, so that 
it can register itself and ensure that invocations on the Hello interface are
routed to its servant object.


<A name="rootnc">
<H4>Obtaining the Initial Naming Context</H4></A>

<P>In the try-catch block, below instantiation of the servant, we call
<TT>orb.resolve_initial_references()</TT> to get an object reference to the 
name server:

<PRE>
      org.omg.CORBA.Object objRef = orb.resolve_initial_references("NameService");
</PRE>

<P>The string "NameService" is defined for all CORBA ORBs. When you pass in 
that string, the ORB returns a naming context object that is an object reference
for the name service.

<A name="narrow">
<H4>Narrowing the Object Reference</H4></A>

<P>As with all CORBA object references, <TT>objRef</TT> is a generic CORBA object. To use
it as a <TT>NamingContext object</TT>, you must narrow it to its proper type. 
The call to <TT>narrow()</TT> is just below the previous statement:

<PRE>
      NamingContext ncRef = NamingContextHelper.narrow(objRef);
</PRE>

<P>Here you see the use of an <TT>idlj</TT>-generated helper class, similar in
function to <TT>HelloHelper</TT>. The <TT>ncRef</TT> object is now an 
<TT>org.omg.CosNaming.NamingContext</TT>
and you can use it to access the naming service and register the server, as shown
in the next topic.


<A name="naming">
<H4>Registering the Servant with the Name Server</H4></A>


<P>Just below the call to <TT>narrow()</TT>, we
create a new <TT>NameComponent</TT> member:
<PRE>
      NameComponent nc = new NameComponent("Hello", "");
</PRE>

<P>This statement sets the <TT>id</TT> field of <TT>nc</TT> to "Hello"
and the <TT>kind</TT> component to the empty string. Make sure there are
no spaces between the "". <P>

<P>Because the path to the <TT>Hello</TT> has a single element, 
we create the single-element array that <TT>NamingContext.resolve</TT>
requires for its work:
<PRE>
      NameComponent path[] = {nc};
</PRE>

<P>Finally, we pass <TT>path</TT> and the servant object to the naming service, binding
the servant object to the "Hello" id:
<PRE>
      ncRef.rebind(path, helloRef);
</PRE>

<P>Now, when the client calls <TT>resolve("Hello")</TT> on the initial naming
context, the naming service returns an object 
reference to the <TT>Hello</TT> servant.<P>




<!--**************************************-->
<A name="invoke">
<H3>Waiting for Invocation</H3></A>

<P>The previous sections describe the code that makes the server ready; the next section 
explains the code that enables it to simply wait around for a client to request
its service.  The following code, which is at the end of 
(but within) the try-catch block, shows how to accomplish this.
<PRE>
      java.lang.Object sync = new java.lang.Object();
      synchronized(sync){
        sync.wait();
      }
</PRE>

<P>This form of <TT>Object.wait()</TT> requires <TT>HelloServer</TT> to 
remain alive 
(though quiescent) until an invocation comes from the ORB. Because of its 
placement in <TT>main()</TT>, after an invocation completes and <TT>sayHello()</TT>
returns, the server will wait again.



<!--**************************************************-->
<A name="compile">
<H2>Compiling the Hello World Server</H2></A>

<P>Now we will compile the <TT>HelloServer.java</TT> so that we can correct any error
before continuing with this tutorial.

<P>Windows users note that you should substitute backslashes (\) for
the slashes (/) in all paths in this document.

<P>To compile <TT>HelloServer.java</TT>,
<OL>
<LI>Change to the <TT>Hello</TT> directory.<P>
<LI>Run the Java compiler on <TT>HelloServer.java</TT>:
<PRE>
javac HelloServer.java HelloApp/*.java
</PRE>
<LI>Correct any errors in your file and recompile if necessary. 
(You can copy the file from <A href="server/HelloServer.java">HelloServer.java</A>, 
if you have trouble finding your typographical errors).<P>
<LI>The files <TT>HelloServer.class</TT> and
<TT>HelloServant.class</TT> are generated in the <TT>Hello</TT> directory.
</OL>

<A name="running">
<H3>Running the Hello World Server</H3></A>

<P>The next section describes <A HREF="GScompile.html">Running the Hello World Application</A>.

<!--**************************************-->
<A name="information">
<H2>For More Information</H2></A>

<DL>
<DT><A href="../jidlExceptions.html#systemexceptions">Exceptions: System Exceptions</A>
<DD>Explains how CORBA system exceptions work and provides details on the
minor codes of Java&nbsp;IDL's system exceptions

<DT><A href="../jidlServers.html">Developing Servers</A>
<DD>Covers topics of interest to CORBA server programmers

<DT><A href="../jidlNaming.html">Naming Service</A>
<DD>Covers the COS Naming Service in greater detail

</DL>

<P><HR>
<CENTER><P><A href="GSapp.html">Previous:Developing a Client Application</A> or <A href="GSapplet.html">Developing a Client Applet</A> <BR> 
<A href="GScompile.html">Next: Running the Hello World Application</A> <BR> 
<A href="../GShome.html">Tutorial home</A> | 
<A href="server/HelloServer.java"><TT>HelloServer.java</TT></A>

<TABLE cellpadding=8 cellspacing=4>
<TR>
  <TD ALIGN=CENTER><A href="../index.html">
Home</A></TD>
</TR></TABLE></CENTER

<HR>
<FONT
SIZE="-2"><A HREF="http://www.sun.com/share/text/SMICopyright.html">Copyright
&copy;</A></FONT><FONT SIZE="-2"> 1996, 1997 Sun Microsystems, Inc.,
2550 Garcia Ave., Mtn. View, CA. 94043-1100 USA., All rights
reserved.</FONT></P>

</BODY>
</HTML>


